---
title: "Session 08 â€” Azure OpenAI ã§ gptâ€‘4o mini ã« â€œã“ã‚“ã«ã¡ã¯ï¼â€"
emoji: "â˜ï¸"
type: "tech"
series: "40 Days GenAI Hack"
topics: \["azure-openai", "python", "api"]
published: true
publication\_date: "2025-07-19"
---

## TL;DR

* Azure OpenAI ãƒªã‚½ãƒ¼ã‚¹ã§ **gptâ€‘4o mini** ã‚’â€œminiâ€ã¨ã„ã†ãƒ‡ãƒ—ãƒ­ã‚¤åã§ç”¨æ„
* `.env` ã« **API ã‚­ãƒ¼ / ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ / ãƒ‡ãƒ—ãƒ­ã‚¤å** ã® 3 è¡Œã‚’è¿½åŠ ã™ã‚‹ã ã‘ã§ SDK ãŒæ¥ç¶š
* Python 15 è¡Œã®åŒæœŸã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã€Œã“ã‚“ã«ã¡ã¯!ã€ã‚’è¿”ç­”ã•ã›ã‚‹
* 1 ãƒªã‚¯ã‚¨ã‚¹ãƒˆ â‰’ 0.07 å††ã€ã‚³ã‚¹ãƒˆã»ã¼ã‚¼ãƒ­
* main ãƒ–ãƒ©ãƒ³ãƒã¸ã¯ **Session ãƒ–ãƒ©ãƒ³ãƒ â†’ PR â†’ Merge** ã§å…¬é–‹

---

## 1. ã‚´ãƒ¼ãƒ«

| é …ç›®          | å†…å®¹                                        |
| ----------- | ----------------------------------------- |
| **Session** | 08                                        |
| **ä¸»é¡Œ**      | Azure OpenAI + gptâ€‘4o mini ã§ãƒãƒ£ãƒƒãƒˆ API å‘¼ã³å‡ºã— |
| **æˆæœç‰©**     | `sessions/s08/openai_hello.py`            |
| **æƒ³å®šã‚³ã‚¹ãƒˆ**   | â‰¤ Â¥0.1/å›                                  |

---

## 2. Azure å´ã®ç¢ºèª (5â€¯min)
Session 5 ã§ä½œæˆã—ãŸç’°å¢ƒã‚’å†ç¢ºèª
1. Azure Portal â†’ **OpenAI** ãƒªã‚½ãƒ¼ã‚¹ç¢ºèª (`S0`, `East US`)
2. *Deployments* ã§ **Model** = *gptâ€‘4oâ€‘miniâ€‘2025â€‘04â€‘16*, **Name** = `mini`
3. Keys & Endpoint ã‹ã‚‰

   * ã‚­ãƒ¼: `<your Azure OpenAI key>`
   * ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: `https://aoai-eastus.openai.azure.com/`
4. **API version**: `2024â€‘05â€‘01â€‘preview`

---

## 3. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š (3â€¯min)

```bash
# ä»®æƒ³ç’°å¢ƒã‚’æœ‰åŠ¹åŒ–
.\.venv\Scripts\activate

# SDK + dotenv
pip install openai python-dotenv --upgrade
```

`.env` ãƒ«ãƒ¼ãƒˆç›´ä¸‹:
---

## 4. ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè£… (10â€¯min)

```python
# sessions/s08/openai_hello.py
"""Azure OpenAI ã§ gptâ€‘4o mini ã«æŒ¨æ‹¶ã—ã¦ã‚‚ã‚‰ã†åŒæœŸã‚µãƒ³ãƒ—ãƒ«"""
import os, sys
from dotenv import load_dotenv
import openai

load_dotenv()  # .env ã‚’ãƒ­ãƒ¼ãƒ‰

client = openai.AzureOpenAI(
    api_key=os.getenv("AZURE_OPENAI_API_KEY"),
    azure_endpoint=os.getenv("AZURE_OPENAI_ENDPOINT"),
    api_version="2024-05-01-preview",
)

DEPLOY = os.getenv("AZURE_OPENAI_DEPLOYMENT")
SYSTEM = "You are a friendly Japanese assistant."

def main() -> None:
    if len(sys.argv) != 2:
        sys.exit("ä½¿ã„æ–¹: python openai_hello.py <ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™ºè©±>")

    resp = client.chat.completions.create(
        model=DEPLOY,  # Azure ã¯ãƒ‡ãƒ—ãƒ­ã‚¤å
        messages=[
            {"role": "system", "content": SYSTEM},
            {"role": "user", "content": sys.argv[1]},
        ],
        max_tokens=64,
        temperature=0.7,
    )
    print("ğŸ¤–:", resp.choices[0].message.content.strip())

if __name__ == "__main__":
    main()
```

---

## 5. å®Ÿè¡Œ & çµæœ (1â€¯min)

![å®Ÿè¡Œçµæœ](/images/s08-hello-output.png)

é€ 15 tok / å— 15 tok â†’ **ç´„ Â¥0.07**\*\*

---

## 6. GitHub main ã¸å…¬é–‹ (7â€¯min)

```bash
git checkout -b session/08-hello-mini
git add sessions/s08/openai_hello.py
git commit -m "feat: session08 azure openai hello"
git push -u origin session/08-hello-mini
```

1. GitHub â†’ Pull Request (`base: main` / `compare: session/08-hello-mini`)
2. CI âœ… ï¼†ãƒ¬ãƒ“ãƒ¥ãƒ¼ â†’ **Rebase & merge**
3. `git checkout main && git pull origin main` ã§ãƒ­ãƒ¼ã‚«ãƒ«æ›´æ–°

---

## 7. ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒˆ

| ç—‡çŠ¶                                                   | åŸå›                                   | è§£æ±º                                       |
| ---------------------------------------------------- | ----------------------------------- | ---------------------------------------- |
| `NotFoundError 404`                                  | ãƒ‡ãƒ—ãƒ­ã‚¤å or ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ or API version ä¸ä¸€è‡´ | `.env` ã®3å¤‰æ•°ã¨ Portal ã®å€¤ã‚’å†ç¢ºèª               |
| `AuthenticationError`                                | ã‚­ãƒ¼èª¤ã‚Š                                | Portal ã® **Key1** ã‚’å†ã‚³ãƒ”ãƒ¼                  |
| `TypeError: ChatCompletion can't be used in 'await'` | åŒæœŸã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã« `await` ä½¿ç”¨                | **åŒæœŸç‰ˆã‚³ãƒ¼ãƒ‰**ã«ä¿®æ­£ or `AsyncAzureOpenAI` ã«åˆ‡æ›¿ãˆ |

---

## 8. å­¦ã³ãƒã‚¤ãƒ³ãƒˆ

* OpenAI SDK v1 ç³»ã¯ **Azure å‘ã‘ã‚¯ãƒ©ã‚¹**ã‚’å†…è”µ (`AzureOpenAI`)
* **ãƒ‡ãƒ—ãƒ­ã‚¤å** = Azure å›ºæœ‰æ¦‚å¿µã€‚ãƒ¢ãƒ‡ãƒ«åã§ã¯ãªã *è‡ªåˆ†ã§ä»˜ã‘ãŸåå‰* ã‚’ `model=` ã«æ¸¡ã™
* éåŒæœŸãŒå¿…è¦ã«ãªã£ãŸã‚‰ `AsyncAzureOpenAI` + `await` ã«ãƒ¯ãƒ³ã‚¿ãƒƒãƒã§ç§»è¡Œå¯èƒ½

---

## 9. æ¬¡å›äºˆå‘Š

Session 09 ã§ã¯ gpt-4o mini ã® ã‚¹ãƒˆãƒªãƒ¼ãƒ å¿œç­” ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«æµã—ã€
ãã®æ§˜å­ã‚’ ShareX ã§ GIF åéŒ²ã—ã¦ã¿ã¾ã™ ğŸš€
