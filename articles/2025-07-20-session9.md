---
title: "Session 09 â€” gptâ€‘4o mini ã‚¹ãƒˆãƒªãƒ¼ãƒ å¿œç­”ã‚’ GIF ã«éŒ²ç”»"
emoji: "ğŸ¬"
type: "tech"
series: "40 Days GenAI Hack"
topics: ["azure-openai", "stream", "gif", "windows"]
published: false
publication\_date: "2025-07-22"
---

## TL;DR

- Azure OpenAI gptâ€‘4o mini ã® **ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å‡ºåŠ›** ã‚’ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«æµã—ç¶šã‘ã‚‹
- Windows ã®ç„¡æ–™ãƒ„ãƒ¼ãƒ« **ShareX** ã§ãã®æ§˜å­ã‚’ GIF éŒ²ç”» â†’ `images/s09-stream-demo.gif`
- ãŠé¡Œã¯ã‚»ãƒ³ã‚·ãƒ†ã‚£ãƒ–ã§ãªã„ **ã€Œå¯Œå£«å±±ã‚’300æ–‡å­—ã§ç´¹ä»‹ã—ã¦ã€**
- ã‚¨ãƒ©ãƒ¼å›é¿ã®ãŸã‚ *ç©ºãƒãƒ£ãƒ³ã‚¯* ã‚’ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã«ä¿®æ­£æ¸ˆã¿
- æˆæœç‰©ã‚’ Session ãƒ–ãƒ©ãƒ³ãƒã‹ã‚‰ **main ã¸ PR â†’ Merge** ã— Zenn ã«å…¬é–‹

---

## 1. ã‚´ãƒ¼ãƒ«

| é …ç›®          | å†…å®¹                                                           |
| ----------- | ------------------------------------------------------------ |
| **Session** | 09                                                           |
| **ä¸»é¡Œ**      | ã‚¹ãƒˆãƒªãƒ¼ãƒ å¿œç­” + GIF éŒ²ç”»                                             |
| **æˆæœç‰©**     | `sessions/s09/stream_demo.py` / `images/s09-stream-demo.gif` |
| **ã‚³ã‚¹ãƒˆ**     | â‰ˆ Â¥2                                                         |

---

## 2. äº‹å‰æº–å‚™ (5 min)

```powershell
winget install ShareX.ShareX           # éŒ²ç”»ãƒ„ãƒ¼ãƒ«
chcp 65001                              # ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’ UTFâ€‘8
python -m pip install openai python-dotenv --upgrade
```

`.env` ã¯ Session 08 ã¨åŒã˜ 3 è¡Œã‚’åˆ©ç”¨ã€‚

---

## 3. ãƒ–ãƒ©ãƒ³ãƒ & ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ (2 min)

```powershell
git checkout -b session/09-stream-demo
mkdir sessions\s09
```

---

## 4. ã‚¹ã‚¯ãƒªãƒ—ãƒˆ `sessions/s09/stream_demo.py` (ä¿®æ­£ç‰ˆ)

```python
import os, sys
from dotenv import load_dotenv
import openai
# osï¼šç’°å¢ƒå¤‰æ•°ï¼ˆè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãªã©ï¼‰ã‚’èª­ã¿å–ã‚‹ãŸã‚ã«ä½¿ã†
# sysï¼šã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ï¼ˆå…¥åŠ›ï¼‰ã‚’å—ã‘å–ã‚‹ãŸã‚ã«ä½¿ã†
# load_dotenvï¼š.envãƒ•ã‚¡ã‚¤ãƒ«ã¨ã„ã†è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰APIã‚­ãƒ¼ãªã©ã‚’èª­ã¿è¾¼ã¿
# openaiï¼šAzure OpenAI APIã‚’ä½¿ã†ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

load_dotenv()

client = openai.AzureOpenAI(
    api_key=os.getenv("AZURE_OPENAI_API_KEY"),
    azure_endpoint=os.getenv("AZURE_OPENAI_ENDPOINT"),
    api_version="2024-05-01-preview",
)

DEPLOY = os.getenv("AZURE_OPENAI_DEPLOYMENT")  # ä¾‹: mini

# .envãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ã„ã¦ã‚ã‚‹ç§˜å¯†æƒ…å ±ï¼ˆAPIã‚­ãƒ¼ã€ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€ãƒ¢ãƒ‡ãƒ«ã®åå‰ï¼‰ã‚’å–å¾—
# client ã¯Azure OpenAIã®ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã‚’ä½¿ã†ãŸã‚ã®æº–å‚™
# DEPLOY ã¯ä½¿ã†ãƒãƒ£ãƒƒãƒˆãƒ¢ãƒ‡ãƒ«ã®ã€Œåå‰ã€ï¼ˆAzureã§è¨­å®šã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ï¼‰

def main() -> None:
    if len(sys.argv) < 2:
        sys.exit("ä½¿ã„æ–¹: python stream_demo.py <è³ªå•æ–‡>")
        # ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã§è³ªå•ãŒå…¥åŠ›ã•ã‚Œãªã‹ã£ãŸã‚‰çµ‚äº†
        # ä½¿ã„æ–¹ã®ä¾‹ï¼špython stream_demo.py æ˜æ—¥ã®å¤©æ°—ã¯ï¼Ÿ
    user = " ".join(sys.argv[1:])
        #è³ªå•ã®éƒ¨åˆ†ï¼ˆã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã§å…¥åŠ›ã—ãŸæ–‡å­—åˆ—ï¼‰ã‚’ user ã«ä»£å…¥

    stream = client.chat.completions.create(
        model=DEPLOY,
        messages=[
            {"role": "system", "content": "ã‚ãªãŸã¯ä¸å¯§ãªæ—¥æœ¬èªã§ç­”ãˆã‚‹ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚"},
            {"role": "user",   "content": user},
        ],
        stream=True,            # â˜… ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚° ON
        max_tokens=512,
    )
# ChatGPTã«è³ªå•ã‚’é€ä¿¡
# system ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã€Œä¸å¯§ãªæ—¥æœ¬èªã§ç­”ãˆã¦ãã ã•ã„ã€ã¨æŒ‡ç¤º
# stream=True ã«ã‚ˆã‚Šã€å›ç­”ãŒå°‘ã—ãšã¤å±Šãï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤ºç”¨ï¼‰

    ...
    print("ğŸ¤–:", end=" ", flush=True)
    for chunk in stream:
        if not chunk.choices:          # â˜… è¿½åŠ : ç©ºãƒãƒ£ãƒ³ã‚¯ã‚’ç„¡è¦–
            continue
        choice = chunk.choices[0]
        delta = getattr(choice, "delta", None)
        if delta and delta.content:
            print(delta.content, end="", flush=True)
    print()  # æ”¹è¡Œ
    # ãƒãƒ£ãƒƒãƒˆã®è¿”ç­”ã‚’å°‘ã—ãšã¤è¡¨ç¤º
    # ãŸã¨ãˆã°é•·æ–‡ãªã‚‰ã€1æ–‡å­—ãšã¤ or 1å˜èªãšã¤ç”»é¢ã«å‡ºã¦ãã‚‹æ„Ÿã˜
    # flush=True ã¯ã€Œã™ãã«è¡¨ç¤ºã™ã‚‹ã€ãŸã‚ã®æŒ‡å®š

if __name__ == "__main__":
    main()
# ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒç›´æ¥å®Ÿè¡Œã•ã‚ŒãŸã¨ãã ã‘ main() ã‚’å‹•ã‹ã™
```

---

## 5. å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰ & ShareX éŒ²ç”» (15 min)

```powershell
python sessions\s09\stream_demo.py "å¯Œå£«å±±ã‚’300æ–‡å­—ã§ç´¹ä»‹ã—ã¦ãã ã•ã„"
```

1. ShareX â†’ **ã‚­ãƒ£ãƒ—ãƒãƒ£** â€º *ç”»é¢éŒ²ç”» (GIF)*
2. ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’ã‚¯ãƒªãƒƒã‚¯ã—éŒ²ç”»é–‹å§‹
3. å¿œç­”ãŒçµ‚ã‚ã£ãŸã‚‰è‡ªå‹•ä¿å­˜ â†’ ç”»åƒã‚’ `images/s09-stream-demo.gif` ã«ãƒªãƒãƒ¼ãƒ 

![å®Ÿè¡Œçµæœ](/images/09-stream-demo.gif)

---

## 6. GitHub å…¬é–‹ (5 min)

```powershell
git add sessions/s09/stream_demo.py images/s09-stream-demo.gif
git commit -m "feat: session09 stream demo & gif"
git push -u origin session/09-stream-demo
```

PR â†’ **Rebase & merge** â†’ main ã‚’æ›´æ–°

---

## 7. ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼

| ç—‡çŠ¶                                    | åŸå›  / è§£æ±º                     |
| ------------------------------------- | --------------------------- |
| `IndexError: list index out of range` | ç©ºãƒãƒ£ãƒ³ã‚¯å‡¦ç†ãŒç„¡ã„ â†’ ä¸Šè¨˜ã‚³ãƒ¼ãƒ‰ã§è§£æ±º       |
| æ–‡å­—åŒ–ã‘                                  | `chcp 65001` ã§ UTFâ€‘8 ã«      |
| GIF ãŒå¤§ãã„                              | ShareX è¨­å®š: FPS=8, å“è³ª=70 ã«èª¿æ•´ |

---

## 8. ã‚³ã‚¹ãƒˆè¦‹ç©

| 1 è©¦è¡Œ   | in 300 tok | out 300 tok | åˆè¨ˆ       |
| ------ | ---------- | ----------- | -------- |
| å˜ä¾¡     | \$0.0011   | \$0.0044    | Â¥1.0     |
| 2 å›ãƒ†ã‚¹ãƒˆ | â€“          | â€“           | **â‰ˆ Â¥2** |

---

## 9. æ¬¡å›äºˆå‘Š

Session 10 ã§ã¯ **ç”»åƒç”Ÿæˆ & Whisper éŸ³å£°èªè­˜** ã‚’çµ„ã¿åˆã‚ã›ãŸãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ€ãƒ«ä½“é¨“ã‚’è¡Œã„ã¾ã™ ğŸš€

